## Hyper-V

博客[https://www.cnblogs.com/daxiongblog/p/14293131.html]

#### 安装Hyper-V

在控制面板中的Windows features中，启动Hyper-v相关组件之后重启即可



#### 配置网络

两种方式

**桥接式**

将虚拟机网络与外部网络进行桥接，并且配置网桥的DNS和IP，与外部网络的原DNS和IP一致

虚拟系统的网络的地址与外部网络处于同一网段，这样容易造成IP冲突

NAT

网络地址转换模式，让虚拟机网络与外部网络共享，使得内部是一个私有网络，安全性好，但只能向外连接，外部系统会虚拟一个IP地址，这个地址与虚拟机网络的IP处于同一网段，与外部网络处于不同网段，不占用公有IP

使用Hyper-V管理器，在`Virtual Switch Manager`中新建一个switch，填写name和description，选择外部网络，之后在虚拟机里面连接到该switch



#### 安装Ubuntu 20

##### 配置临时ip

```
// 给以太网接口eno1添加一个ip
sudo ip addr add 192.168.1.22/24 dev eno1
// 启用这个ip
sudo ip link set dev eno1 up
```





## Linux

> 在linux中，一切皆为文件（网络、磁盘、cpu等设备也会被映射成文件）

### Linux结构

#### 分区

一般是三个分区

**boot**：引导分区，一般分配1GB

**swap**：交换分区，一般分配2GB（与os的内存相同）

**root**：根分区，其余的都是根分区，用户的文件都存储在这里

#### 目录结构

* /bin
  * 存放最常用的二进制的命令的
  * 其他的命令是（/usr/bin, /usr/local/bin）
* /sbin
  * 存放的是系统管理员使用的系统管理命令
* /home
  * 存放普通用户的主目录
* /root
  * 系统管理员的一些文件
* /lib
  * 系统开机所需要的最基本的动态链接共享库，作用类似于windows的dll
* /lost+found
  * 当系统非法关机了，这里就保存了一些文件
* /etc
  * 所有的系统管理所需要的配置文件和子目录
* /usr
  * 用户的很多应用程序和文件，类似于windows的program files目录
* /boot
  * 启动linux的一些核心文件，包括一些链接文件，连接文件和镜像文件
* /proc
  * 是一个虚拟的目录，是系统内存的映射，访问这个目录可以获得系统信息
* /srv
  * service的缩写，该目录存放一些服务启动之后需要提取的数据
* /sys
* /tmp
  * 存放一些临时文件
* /dev
  * 类似于windows的设备管理器，把所有的硬件按文件的形式存储
* /media
  * linux系统会自动识别一些设备，比如U盘，光驱等。当识别后，linux会把识别的设备挂载到这个目录下
* /mnt
  * 该目录为了让用户临时挂载别的文件系统，我们将外部的存储设备挂载在/mnt，然后进入该目录可以查看里面的内容
* /opt
  * 这是给主机额外安装软件所存放的目录
* /usr/local
  * 另一个给主机安装软件的位置，一般是通过源码编译方式安装的程序
* /var
  * 这个目录存放着不断扩充的东西，习惯性地将经常修改的目录放在这个目录下，包括各种日志文件



#### 远程登录

使用XShell进行远程登录

需要获取远程主机的ip地址



**问题**

出现`Xshell连接服务器失败：Could not connect to ‘192.168.191.128‘ (port 22): Connection failed.`

一般是ssh在服务器端没有安装

1. `ps -e|grep ssh`  检查是否安装了ssh（一般都会有ssh-agent）
2. `sudo apt-get install openssh-server ` 安装ssh-server
3. `/etc/init.d/ssh start`   启动ssh-server服务



#### vim

##### vim快捷键

yy 复制当前行

nyy 复制当前光标所在行开始的n行

p粘贴

dd 删除当前行

ndd 删除当前光标所在行开始的n行

/关键字  查找关键字出现在文件中的位置，按n显示下一个

:set nu 显示行号

:set nonu 不显示行号

n shift+g 跳转到第n行

G 跳转到文件末尾

gg 跳转到文件开始

u 撤销上一次的操作



#### 关机重启注销

shutdown -h now  关机

halt  关机

shutdown -h 1  1分钟后关机

shutdown -r now  重启

reboot  重启

sync  将内存中的数据同步到磁盘中

注意：不管是重启还是关闭，首先要运行sync命令，目前的shutdown等命令已经在关机前进行了sync



如果有的时候执行一些命令或者访问一些文件，显示权限不够，想要切换到root用户，可以使用`su - root`

使用`logout`命令可以注销当前用户，回到上一个用户，如果上一个用户不存在，则推出系统



#### 用户管理

**添加用户**

> 注意：Ubuntu新版本在创建用户时，不会创建家目录

`useradd [用户名]`  创建用户，并在/home下创建用户的家目录

`useradd -d [目录名] [用户名]`  在指定目录下创建用户

**删除用户**

`userdel [用户名]`  删除用户，但保留家目录

`userdel -r [用户名]`  删除用户，同时删除家目录

**修改密码**

`passwd [用户名]`

**查看用户信息**

`id [用户名]`

**切换用户**

`su - [用户名]`

注意：从高权限用户转换到低权限用户，不需要输入密码

**显示登录时的用户**

`who am i`



#### 用户组管理

> 类似于角色，系统对有共性/权限的多个用户进行统一的管理

**新增组**

`groupadd [组名]`

**删除组**

`groupdel [组名]`

**增加用户时直接加上组**

`useradd -g [用户组] [用户名]`

注：如果增加用户时不指定组，会默认创建一个与用户名同名的组，将其放入该组

**修改用户所在的组**

`usermod -g [新组名] [用户名]`



**用户和组相关的文件**

`/etc/passwd`

​	每行的含义：`用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录shell`

`/etc/shadow`

​	每行的含义：`登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告事件:不活动时间:失效时间:标志`

`/etc/group`

​	每行含义：`组名:口令:组标识号:组内用户列表`



#### 运行级别

|      | 说明                      |
| ---- | ------------------------- |
| 0    | 关机                      |
| 1    | 单用户 [用来找回丢失密码] |
| 2    | 多用户状态，没有网络服务  |
| 3    | 多用户状态，有网络服务    |
| 4    | 系统未使用，保留给用户    |
| 5    | 图形界面                  |
| 6    | 系统重启                  |

常用的运行级别是3和5，也可以指定默认的运行级别

使用`init [运行级别]`可以切换运行级别

使用`systemctl get-default`查看当前系统的默认运行级别

使用`systemctl set-default graphical.target`修改系统的默认运行级别为5，即图形化界面

`multi-user.target`  等价于运行级别3

`graphical.target`  等价于运行级别5



#### 帮助指令

`man [命令名称或配置文件]`   获得帮助信息

`help [命令名称]`  获取内置shell命令的帮助信息



#### 文件目录类指令

`ls`  列出文件

​	-a all

​	-l  list

`cd [路径]`  跳转指令

​	cd 或者 cd ~  跳转到家目录

`mkdir`  创建文件夹

​	-p  级联创建文件夹

`rmdir`  删除空文件夹

`rm`  移除文件或者目录

​	`rm -rf [路径]`  强制递归删除路径下的所有文件和文件名

`touch [文件名]`  在当前工作目录下创建一个文件

`cp [选项] source dest`  拷贝文件到指定目录

​	-r  递归复制整个文件夹

​	这样做会有一个问题，当复制的文件在dest已存在的时候，会逐个询问是否覆盖，如果要强制覆盖需要使用`\cp -r source dest`

`mv oldFileName newFileName`  重命名

`mv [旧路径名] [新路径名]`  移动文件

`cat [选项] [文件名]`  查看文件

​	-n 显示行号

`more [文件名]`  查看文件（交互式）

​	space  向下翻页

​	enter  显示下一行

​	q	 退出

​	ctrl + f  向下滚动一个屏幕

​	ctrl + b  向上滚动一个屏幕

​	=  输出当前行号

​	:f  输出文件名和当前行号

`less [文件名]`  分屏查看文件内容

​	不是一次性加载文件全部内容，而是根据显示需要加载，对显示大型文件具有较高的效率

​	space  向下翻一页

​	[pagedown]  向下翻一页

​	[pageup]  向上翻一页

​	/str	向下查找str的位置（n向下查找，N向上查找）

​	?str  向上查找str的位置 （n向下查找，N向上查找）

​	q  退出

`echo content`  输出内容到控制台

`head [文件]`  显示文件的前10行

​	-n 5  显示前5行

`tail [文件]` 显示文件的最后10行

​	-n 5  显示最后5行

​	-f  实时监控

`>` 输出重定向，将内容覆盖到一个指定的文件

`>>`  输出重定向，将内容追加到一个指定的文件

`ln -s [原文件或目录] 软链接名` 给原文件创建一个软链接

​	软链接，也称符号链接，类似windows的快捷方式，存放了链接其他文件的路径

`history`  显示所有使用过的命令

​	`history 10`  显示最近使用的10条命令

`!120`  执行编号为120的命令（ 编号根据历史记录）



#### 时间日期类

`date`  显示当前日期

`date "+%Y"`  显示当前年份

`date "+%Y-%m-%d %H:%M:%S"`   显示年月日时分秒

`date -s "2020-11-03 20:02:10"`  设置当前系统时间是2020年11月3日  20点2分10秒

`cal`  显示当月日历

`cal 2020`  显示2020年日历



#### 搜索查找类

`find [搜索范围] [选项]`  从指定目录向下递归地遍历其各个子目录，将满足条件的文件或者目录显示在终端

​	-name <查询方式>  按照指定的文件名查找模式查找文件

​	-user <用户名>  查找属于指定用户名的所有文件

​	-size <文件大小>  按照指定的文件大小查找文件（+n大于，-n小于，n等于，单位k，M,G）

`locate [文件名]`  快速定位文件路径。利用事先创建的系统中所有文件名称和路径的locate数据库实现快速定位给定的文件，locate指令无需遍历整个文件系统，查询速度较快。为了确保查询结果的准确度，需要定期更新locate数据库

​	注意：第一次运行前，需要使用updatedb指令

`which [指令名]`  查看指令在哪个目录下

`grep [选项] 查找内容 原文件`  在文件中查找`查找内容`

​	-n  显示匹配行以及行号

​	-i  忽略大小写



#### 压缩和解压缩命令

`gzip [文件]`  压缩文件，只能将文件压缩为*.gz文件 

`gunzip [文件]`  解压缩文件

`zip [选项] XXX.zip [要被压缩的文件或者目录]`  压缩文件或者文件夹

​	-r  递归压缩，即压缩目录

`unzip [选项] XXX.zip`  解压缩文件或者目录

​	-d <目录>  指定解压后文件的目录

`tar [选项] XXX.tar.gz 打包的内容`

​	-c  生成.tar打包文件

​	-v  显示详细信息

​	-f  指定压缩后的文件名

​	-z	打包同时压缩

​	-x  解压.tar文件

​	-C 解压缩后文件的位置（不设置，默认是当前目录）

​	`tar -zcvf bzhan.tar.gz /home/bzhan`  压缩bzhan目录生成bzhan.tar.gz文件

​	`tar -zxvf bzhan.tar.gz -C <解压后的路径>`  解压缩bzhan.tar.gz



#### 文件目录权限

**改变文件所有者**

`chown 用户名 文件/目录名`  

-r 递归目录下的子文件或目录，也将其所有者修改为新用户名



**修改文件的组**

`chgrp 组名 文件/目录名`

-r 递归目录下的子文件或目录，也将其所有者修改为新组名



#### rwx

对于文件

​	r可读  w可写  x可执行

对于目录

​	r可读  w可修改  x可进入

删除一个文件需要对这个文件的目录拥有写的权限



#### 修改权限

chmod，可以修改文件或者目录的权限

u: 所有者  g:所有组  o:其他人  a:所有人（ugo的总和）

1 通过=，+，-变更权限

`chmod u=rwx,g=rx,o=x 文件/目录名` 将文件或目录的所有者设置为rwx，所属组设置为rx，其他人设置为x

`chmod o+w 文件/目录名`  将文件或目录的其他人添加写的权限

`chmod a-x 文件/目录名`  所有的人对该文件或目录不具备x权限   

2 通过数字变更权限

r=4, w=2, x=1  rwx=7

`chmod 数字 目录/文件名`



#### crond定时任务

crontab进行定时任务的设置

任务调度：是指系统在某个时间执行的特定的命令或程序

任务调度分类：

1. 系统工作
   * 有些重要的工作必须周而复始地执行，比如病毒扫描等
2. 个别用户工作
   * 个别用户可能希望执行某些程序，比如对mysql数据库的备份

基本语法：`crontab [选项]`

​	-e：编辑crontab定时任务

​	-l：查看crontab任务

​	-r：删除当前用户所有的crontab任务

service crond restart  重启任务调度

crontab -e 进入文件编辑界面，在文件中编写`*/1 * * * * echo 1 > /tmp/to.txt`，保存并退出

完成后，terminal会显示`crontab: installing new crontab`

| 项目    | 含义                 | 范围                    |
| ------- | -------------------- | ----------------------- |
| 第一个* | 一小时当中的第几分钟 | 0-59                    |
| 第二个* | 一天当中的第几小时   | 0-23                    |
| 第三个* | 一个月当中的第几天   | 1-31                    |
| 第四个* | 一年当中的第几月     | 1-12                    |
| 第五个* | 一周当中的星期几     | 0-7（0和7都代表星期天） |

特殊符号的说明

| 特殊符号 | 含义                                                         |
| -------- | ------------------------------------------------------------ |
| *        | 代表任何时间。比如，第一个*表示一小时中每分钟执行一次        |
| ,        | 代表不连续时间，比如“0 8,12,16 * * * ”就表示每天的8点0分，12点0分，16点0分都执行一次 |
| -        | 代表连续时间范围，比如“0 5 * * 1-6”表示周一到周六的5点执行一次 |
| */n      | 代表每隔多久执行一次。比如“*/10 * * * *”表示每隔10分钟执行一次 |

**案例**

* 每隔1分钟，就将当前的日期信息，追加到`/tmp/mydate`文件中
  * crontab -e
  * `*/1 * * * * date >> /tmp/mydate`
* 每隔1分钟，就将当前日期和日历都追加到`/home/mycal`文件中
  * crontab -e
  * `*/1 * * * *  脚本文件 `
* 每天凌晨2点，将mysql数据库testdb，备份到文件中
  * 提示: `mysqldump -u root -p 密码 数据库 >> /home/db.bak`
  * crontab -e
  * `0 2 * * * mysqldump -u root -p 密码 数据库 > /home/db.bak`

